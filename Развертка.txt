-1) Компиляция проекта
dotnet publish -c Release -o ./publish

1) Подключение по ssh к серверу
ssh root@185.103.254.12 (ssh <name>@<adress>
Введи пароль

2) Установка dotnet пакетов

sudo dnf install -y https://packages.microsoft.com/config/rhel/8/prod.repo
//sudo dnf install -y dotnet-sdk-8.0.11 - Для разработки

sudo dnf install -y dotnet-runtime-7.0.11 - только для выполнения

sudo dnf install dotnet-sdk-9.0

*!->*sudo dnf install -y dotnet-sdk-8.0

3) Копирование файлов проекта scp -r C:\projects\Super-Bot\publish root@159.255.34.79:/superbot

4) Настройка сервера nginx

5) Настройка MongoDb

Добавьте репозиторий MongoDB
MongoDB не доступен в стандартных репозиториях CentOS/AlmaLinux, поэтому нужно добавить официальный репозиторий MongoDB.

Создайте файл репозитория MongoDB:

bash
Копировать
Редактировать
sudo vim /etc/yum.repos.d/mongodb-org.repo
Вставьте следующий текст для версии MongoDB 6.0 (последняя на момент 2025 года):

ini
Копировать
Редактировать
[mongodb-org-6.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/6.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc


sudo dnf install -y mongodb-org

После установки включите и запустите службу MongoDB:
//sudo systemctl stop mongod
sudo systemctl enable mongod
sudo systemctl start mongod --replSet rs0 --bind_ip localhost

Проверьте статус службы:
sudo systemctl status mongod



cd /superbot
dotnet SuperBot.WebApi.dll


Запуск приложения в фоновом режиме (опционально):



Включение репликации:
sudo vim /etc/mongod.conf

Найдите секцию replication (или создайте её, если она отсутствует) и добавьте следующие строки:

replication:
  replSetName: rs0
net:
  bindIp: localhost // МБ лишнее
Если секция net уже существует, просто измените или добавьте строку bindIp: localhost.


Чтобы ваше приложение работало в фоновом режиме и не завершалось после выхода из сессии SSH, используйте systemd для создания службы.

Создайте файл для вашей службы, например, /etc/systemd/system/myapp.service:

sudo nano /etc/systemd/system/myapp.service
Вставьте следующее содержание:

[Unit]
Description=My ASP.NET Core App
After=network.target

[Service]
WorkingDirectory=/var/www/myapp
ExecStart=/usr/bin/dotnet /var/www/myapp/MyApp.dll
Restart=always
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=dotnet-myapp
User=youruser
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false

[Install]
WantedBy=multi-user.target
Замените youruser на имя пользователя, под которым вы хотите запускать приложение.



0) Команды для линукса (Дополнительные)

[root@tale-shop ~]# ps aux | grep dnf
root        1326  0.0  0.1 221940  1196 pts/0    R+   12:58   0:00 grep --color=auto dnf

 sudo kill -9 1312

[root@tale-shop ~]# dnf list installed

cd - перемещение

ls - просмотр данных в папке

Установка пакетов операционки AlmaLinux

Убедитесь, что у вас включены все стандартные репозитории:

bash
Копировать
Редактировать
sudo dnf repolist
Если отсутствуют EPEL (Extra Packages for Enterprise Linux), установите их:

bash
Копировать
Редактировать
sudo dnf install epel-release -y
После этого обновите кеш репозиториев:

bash
Копировать
Редактировать
sudo dnf makecache
Попробуйте снова установить sshguard:

bash
Копировать
Редактировать
sudo dnf install sshguard

Установка файла подкачки в 2 гига

[root@vm ~]# sudo fallocate -l 2G /swapfile
[root@vm ~]# sudo chmod 600 /swapfile
[root@vm ~]# sudo mkswap /swapfile
Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)
no label, UUID=6b2baf8d-f04a-4118-9045-74a57f1902b7
[root@vm ~]# sudo swapon /swapfile
[root@vm ~]# sudo swapon --show
NAME      TYPE SIZE USED PRIO
/swapfile file   2G   0B   -2

echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

Проверка свободной оперативки

[root@vm ~]# free -h
               total        used        free      shared  buff/cache   available
Mem:           757Mi       325Mi       459Mi        15Mi        73Mi       431Mi
Swap:             0B          0B          0B
[root@vm ~]# top


SSHGuard
SSHGuard — лёгкий инструмент для защиты от атак методом подбора, который работает с различными демонами (например, SSH, Exim и т.д.).

Установка и настройка:
Установите SSHGuard:


sudo dnf install sshguard
Настройте FirewallD для интеграции:

Включите использование sshguard в iptables:
sudo firewall-cmd --permanent --new-service=sshguard
sudo firewall-cmd --permanent --add-service=sshguard
sudo firewall-cmd --reload
Запустите SSHGuard:

sudo systemctl enable --now sshguard
Проверка работы:

sudo systemctl status sshguard
SSHGuard автоматически блокирует IP-адреса, которые совершают подозрительные попытки подключения.


Открыть порт mongodb в фаерволе
[root@vm superbot]# sudo firewall-cmd --add-port=27017/tcp --permanent
success
[root@vm superbot]# sudo firewall-cmd --reload
success

Удаление файлов в папке
rm -f /path/to/directory/*